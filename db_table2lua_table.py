data = """
effect_bundle_key	effect_key	effect_scope	value	advancement_stage			
wh_main_bundle_stance_army_raiding	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh_main_bundle_stance_army_raiding	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_skaven	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_skaven	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh_main_bundle_stance_navy_raiding	wh_main_effect_force_all_campaign_stance_ap_cost	navy_to_navy_own	25.0000	start_turn_completed
wh_main_bundle_stance_navy_raiding	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_horde	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_horde	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_horde_coast	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_horde_coast	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_def	wh_main_effect_force_all_campaign_movement_range	force_to_force_own	-12.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_def	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_bretonnia	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh3_main_bundle_stance_army_raiding_slaanesh	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh3_main_bundle_stance_army_raiding_slaanesh	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh3_main_bundle_stance_army_raiding_ogres	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh3_main_bundle_stance_army_raiding_ogres	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh3_dlc20_bundle_stance_army_raiding_warriors_of_chaos	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh3_dlc20_bundle_stance_army_raiding_vilitch	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh3_dlc20_bundle_stance_army_raiding_valkia	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh3_dlc20_bundle_stance_army_raiding_festus	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh3_dlc20_bundle_stance_army_raiding_azazel	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh2_twa03_bundle_stance_army_raiding_def_rakarth	wh_main_effect_force_all_campaign_movement_range	force_to_force_own	-12.0000	start_turn_completed
wh2_twa03_bundle_stance_army_raiding_def_rakarth	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh3_dlc20_bundle_stance_army_encampment_festus	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh3_dlc20_bundle_stance_army_encampment_chs	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh_main_bundle_stance_army_fortification	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_chd	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_chd	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh3_dlc24_bundle_stance_army_raiding_the_changeling	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_bretonnia	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh2_dlc09_bundle_stance_army_ambush_settlement_tomb_kings	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh3_dlc24_bundle_stance_army_raiding_the_changeling	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
wh2_dlc17_bundle_stance_army_encamp_horde_beastmen_unique_khazrak	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	5.0000	start_turn_completed
wh2_main_bundle_stance_army_astromancy	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh2_main_bundle_stance_army_channelling_hef	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	5.0000	start_turn_completed
wh3_dlc20_bundle_stance_army_ambush_valkia	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh_dlc03_bundle_stance_army_settlement_horde_beastmen	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	5.0000	start_turn_completed
wh_dlc07_bundle_stance_army_ambush_bretonnia	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh_dlc07_bundle_stance_army_ambush_wood_elves	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	5.0000	start_turn_completed
wh_main_bundle_stance_army_ambush	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh_main_bundle_stance_army_channelling_vmp	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	5.0000	start_turn_completed
wh_main_bundle_stance_army_channelling	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	5.0000	start_turn_completed
wh_main_bundle_stance_army_raiding_camp_norsca	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh_main_bundle_stance_army_settlement_horde	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	12.0000	start_turn_completed
wh3_dlc26_bundle_stance_army_raiding_khorne	wh_main_effect_force_all_campaign_stance_ap_cost	army_to_army_own_unseen	25.0000	start_turn_completed
wh3_dlc26_bundle_stance_army_raiding_khorne	wh_main_effect_force_campaign_stance_can_move_extra_stance_display	force_to_force_own	-12.0000	start_turn_completed
"""  # Truncated here for brevity. Replace with your full data string or read from a file.

import csv
from io import StringIO


def lua_escape(s):
    return s.replace("\\", "\\\\").replace('"', '\\"')


def format_value(val):
    # Convert string numeric values to number, else quote string
    try:
        f = float(val)
        if f.is_integer():
            return str(int(f))
        else:
            return str(f)
    except:
        return f'"{lua_escape(val)}"'


def to_lua_table(data_lines):
    reader = csv.DictReader(data_lines, delimiter="\t")

    bundles = {}

    for row in reader:
        bundle = row["effect_bundle_key"]
        effect = row["effect_key"]
        # We'll store a table with value, effect_scope and advancement_stage if you want
        val = row["value"]
        scope = row["effect_scope"]
        adv = row["advancement_stage"]

        if bundle not in bundles:
            bundles[bundle] = {}

        # You can decide the structure; here I'm saving nested table with keys
        bundles[bundle][effect] = {
            "value": format_value(val),
            "effect_scope": scope,
            "advancement_stage": adv,
        }

    # Convert to Lua string
    lua_lines = ["local effect_bundles = {"]

    for bundle_key, effects in bundles.items():
        lua_lines.append(f'  ["{lua_escape(bundle_key)}"] = {{')
        for effect_key, effect_data in effects.items():
            lua_lines.append(f'    ["{lua_escape(effect_key)}"] = {{')
            # Write value as number or string without quotes because already formatted
            lua_lines.append(f'      value = {effect_data["value"]},')
            lua_lines.append(
                f'      effect_scope = "{lua_escape(effect_data["effect_scope"])}",'
            )
            lua_lines.append("    },")
        lua_lines.append("  },")
    lua_lines.append("}")

    return "\n".join(lua_lines)


# Main
data_io = StringIO(data.strip())
lua_table_str = to_lua_table(data_io)
print(lua_table_str)
